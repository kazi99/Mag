\section{Derived categories in geometry}
\label{Chapter: Derived categories in geometry}

This chapter will be devoted to applying results of Chapter \ref{Chapter: Derived categories} to the abelian category $\coherent{X}$ of coherent sheaves on $X$. 
We will first define the bounded derived category of coherent sheaves $\derb{X}$ of a scheme $X$ over $k$ and discuss how this category fits into the broader context of other derived categories. We prove that under some assumptions $\derb{X}$ is indecomposable and admits a spanning class, which will play an important role later on. Generalizing Serre duality we also equip $\derb{X}$ with a Serre functor. 

The second section will cover the construction of various different derived functors having their origin in geometry. These will include the global sections functor, the push-forward along a morphism, different Hom-functors and Ext-functors, the tensor product and Tor-functors, and the pull-back along a morphism. 
We will conclude this chapter by providing a collection of results showcasing relationships that hold between the derived functors of the previous section. These will serve as convenient computational tools especially in Chapter \ref{Chapter: Fourier-Mukai transforms} on Fourier--Mukai transforms.

\subsection{Derived category of coherent sheaves}
\label{Subsection: Derived category of coherent sheaves}

One of the main invariants of a scheme $X$ over $k$ is its category of coherent sheaves $\coherent{X}$. We can think of this category as a slight extension of the category of locally free $\OO_X$-modules of finite rank also known as $k$-vector bundles on $X$ in the sense that $\coherent{X}$ is abelian, whereas the former generally is not. In this chapter we restrict ourselves to noetherian schemes and later to smooth projective varieties over an algebraically closed field $k$. Our primary object of study will be the bounded derived category of coherent sheaves
\[
    \derb{X} := \derb{\coherent{X}}.
\]

In this section some of the results will have to be given without proof,
but we will provide precise references when required. Certain results will serve as the groundwork on which the theory is then further developed, for example statements like certain functors map coherent sheaves into coherent sheaves, while others, like Grothendieck-Verdier duality, lie well outside the scope of this thesis, but are relevant for establishing certain relations among the derived functors. We also mainly focus on showcasing the methods and interactions between the derived functors and not that much on being as general as one can be. 

% \vspace{0.3cm}
\noindent
\textsl{Notation.}
Copying Huybrechts \cite{huybrechts2006fouriermukai}, we will denote by $\mathcal H^i(\F^\bullet)$ the $i$-th cohomology of a complex $\F^\bullet$, not to mistake it for sheaf cohomology $\cohom{i}{X}{\F}$ of $X$ with coefficients in a sheaf $\F$.

% \vspace{0.3cm}

As observed in Chapter \ref{Chapter: Derived categories} the construction of derived functors relied heavily on the existence of some special class of objects in the domain category. The most special of them all being the class of injective objects. As the category of coherent sheaves on $X$ often does not contain enough injectives\footnote{Intuitively this statement may be mirrored with the analogous statement that injective $A$-modules almost never appear to be finitely generated.}, we are forced to expand our scope. Luckily, the contrary is true if we restrict ourselves to noetherian schemes and replace coherent sheaves with quasi-coherent ones. 

\begin{proposition}
    \label{qcoh of noetherian scheme contains enough injectives}
    \emph{\cite[\S II, Theorem 7.18]{Hartshorne1966}}
    The category of quasi-coherent sheaves $\quasicoh{X}$ of a noetherian scheme $X$ contains enough injectives.
    % For a noetherian scheme $X$, its category of quasi-coherent shaves $\quasicoh{X}$ contains enough injectives.
\end{proposition}

\begin{proof}
    This is a consequence of \cite[\S II, Theorem 7.18]{Hartshorne1966},  which states that every quasi-coherent sheaf on a noetherian scheme $X$ can be embedded into a quasi-coherent sheaf, which is an injective $\struct{X}$-module. 
\end{proof}

\begin{proposition}
    \label{Db(X) is bounded derived of quasi-coherent with coherent cohomology}
    \emph{\cite[\S 3, Proposition 3.5]{huybrechts2006fouriermukai}.}
    For a noetherian scheme $X$ the inclusion $\derb{X} \hookrightarrow \derb{\quasicoh{X}}$ induces an equivalence of triangulated categories
    \[
        \derb{X} \natiso \mathsf{D}^b_{\mathsf{coh}}(\quasicoh{X}),
    \]
    where $\mathsf{D}^b_{\mathsf{coh}}(\quasicoh{X})$ is the full triangulated subcategory of $\derb{\quasicoh{X}}$, consisting of bounded complexes of quasi-coherent sheaves on $X$ with coherent cohomology.
\end{proposition}

% \begin{proof}
%     For a proof see \cite[\S 3, Proposition 3.5]{huybrechts2006fouriermukai}.
% \end{proof}

\begin{proposition}
    \label{In Db(X) everything is a complex of vector bundles}
    \emph{\cite[\S 3, Proposition 3.26]{huybrechts2006fouriermukai}}
    Let $X$ be a smooth projective variety over $k$. Then any complex $\F^\bullet$ of $\derb{X}$ is isomorphic in $\derb{X}$ to a bounded complex $\E^\bullet$ of locally free $\struct{X}$-modules of finite rank also known as \emph{vector bundles}.
\end{proposition}

% By a slight abuse of terminology locally free $\struct{X}$-modules of finite rank will be called \emph{vector bundles}.

\begin{proof}
    To prove this proposition we will need the following two facts concerning locally free sheaves on smooth projective varieties.
    \begin{itemize}[label = $\vartriangleright$]
        \item{Any coherent sheaf $\F$ on $X$ is a quotient of a locally free $\struct{X}$-module of finite rank $\E$, \ie there is an epimorphism $\E \twoheadrightarrow \F$ \cite[\S II, Corollary 5.18]{Hartshorne1977}}.
        \item{Let $n$ denote the dimension of $X$. For any coherent sheaf $\F$ on $X$ admitting an exact sequence of coherent sheaves
        \[
            0 \to \E^{-n} \to \E^{-n+1} \to \cdots \to \E^{-1} \to \E^0 \to \F \to 0.
        \]
        If $\E^0$, $\E^{-1}$,..., $\E^{-n+1}$ are locally free, the sheaf $\E^{-n}$ is locally free as well. See \cite[\S B.8.3]{Fulton1998} and note that this is essentially a local statement since a coherent sheaf $\E$ is a vector bundle if and only if all its stalks $\E_x$ are free $\struct{X, x}$-modules \cite[\S1, Lemma 5.1.3]{Weibel2013}.
        % \info{needs reference}
        }
    \end{itemize}
    Pick a bounded complex of coherent sheaves $\F^\bullet$. Without loss of generality assume $\F^i \iso 0$ for $i \leq 1$,
    % and $i > m$ for some $m \in \Z$, 
    otherwise replace $\F^\bullet$ by an appropriate shift of itself. By the first fact and a dual argument to the proof of Proposition \ref{injective resolution} we see that there exists a complex $\E^\bullet$ of vector bundles bounded from above and a quasi-isomorphism $\E^\bullet \to \F^\bullet$.
    % \[
    %     \cdots \to \E^{-n} \to \E^{-n+1} \to \cdots \to \E^{-1} \to \E^0 \to \E^1 \to \cdots \to \E^m \to 0 \to \cdots
    % \]
    \[\begin{tikzcd}[column sep = 1em]
        % https://q.uiver.app/#q=WzAsMjIsWzEsMCwiXFxFXnstbn0iXSxbMiwwLCJcXEVeey1uKzF9Il0sWzMsMCwiXFxjZG90cyJdLFs0LDAsIlxcRV57LTF9Il0sWzUsMCwiXFxFXjAiXSxbNywwLCJcXGNkb3RzIl0sWzgsMCwiXFxFXm0iXSxbOSwwLCIwIl0sWzEwLDAsIlxcY2RvdHMiXSxbMCwwLCJcXGNkb3RzIl0sWzYsMCwiXFxFXjEiXSxbMSwxLCIwIl0sWzIsMSwiMCJdLFszLDEsIlxcY2RvdHMiXSxbNCwxLCIwIl0sWzUsMSwiXFxGXjAiXSxbNywxLCJcXGNkb3RzIl0sWzgsMSwiXFxGXm0iXSxbOSwxLCIwIl0sWzEwLDEsIlxcY2RvdHMiXSxbMCwxLCJcXGNkb3RzIl0sWzYsMSwiXFxGXjEiXSxbMCwxXSxbMSwyXSxbMiwzXSxbMyw0XSxbNSw2XSxbNiw3XSxbNyw4XSxbOSwwXSxbNCwxMF0sWzEwLDVdLFsxMSwxMl0sWzEyLDEzXSxbMTMsMTRdLFsxNCwxNV0sWzE2LDE3XSxbMTcsMThdLFsxOCwxOV0sWzIwLDExXSxbMTUsMjFdLFsyMSwxNl0sWzAsMTFdLFsxLDEyXSxbMywxNF0sWzQsMTVdLFsxMCwyMV0sWzYsMTddLFs3LDE4XV0=
        \cdots & {\E^{-n}} & {\E^{-n+1}} & \cdots & {\E^{0}} & {\E^1} & {\E^2} & \cdots & {\E^m} & 0 & \cdots \\
        \cdots & 0 & 0 & \cdots & 0 & {0} & {\F^2} & \cdots & {\F^m} & 0 & \cdots
        \arrow[from=1-1, to=1-2]
        \arrow[from=1-2, to=1-3]
        \arrow[from=1-2, to=2-2]
        \arrow[from=1-3, to=1-4]
        \arrow[from=1-3, to=2-3]
        \arrow[from=1-4, to=1-5]
        \arrow[from=1-5, to=1-6]
        \arrow[from=1-5, to=2-5]
        \arrow[from=1-6, to=1-7]
        \arrow[from=1-6, to=2-6]
        \arrow[from=1-7, to=1-8]
        \arrow[from=1-7, to=2-7]
        \arrow[from=1-8, to=1-9]
        \arrow[from=1-9, to=1-10]
        \arrow[from=1-9, to=2-9]
        \arrow[from=1-10, to=1-11]
        \arrow[from=1-10, to=2-10]
        \arrow[from=2-1, to=2-2]
        \arrow[from=2-2, to=2-3]
        \arrow[from=2-3, to=2-4]
        \arrow[from=2-4, to=2-5]
        \arrow[from=2-5, to=2-6]
        \arrow[from=2-6, to=2-7]
        \arrow[from=2-7, to=2-8]
        \arrow[from=2-8, to=2-9]
        \arrow[from=2-9, to=2-10]
        \arrow[from=2-10, to=2-11]
    \end{tikzcd}\]
    Hence $\mathcal H^i(\E^\bullet) \iso 0$ for $i \leq 1$ and the right truncation $\rtruncation{1}(\E^\bullet)$ is acyclic. Truncating once more on the \emph{left} at degree $-n$, where $n$ is the dimension of $X$, we obtain an exact sequence $\ltruncation{-n}(\rtruncation{1}(\E^\bullet))$, depicted below
    \[
        0 \to \coker d_\E^{-n-1} \to \E^{-n+1} \to \cdots \to \E^{0} \to \ker d^1_\E \to 0.
    \]
    This is now a resolution of a coherent sheaf $\ker d_\E^1$ by coherent sheaves, where $\E^0$, $\E^{-1}$,..., $\E^{-n+1}$ are vector bundles. By the second fact we see that $\coker d_\E^{-n-1}$ is then a vector bundle, therefore $\ltruncation{-n}(\E^\bullet)$ is a complex of vector bundles quasi-isomorphic to $\E^\bullet$ and consequently also quasi-isomorphic to $\F^\bullet$.
\end{proof}

\begin{definition}
    \label{Definition of support}
    Let $X$ be a scheme. The \emph{support} of an $\struct{X}$-module $\F$ is defined to be the set
    \[
        \supp{\F} = \{x \in X \mid \F_x \not\iso 0 \}.
    \] 
    The \emph{support} of a complex $\F^\bullet$ of $\derb{X}$ is defined to be the union
    \[
        \supp{\F^\bullet} = \bigcup_{i \in \Z} \supp{\mathcal H^i(\F^\bullet)}.
    \]
\end{definition}

\begin{remark}
    \label{supports closed}
    The support $\supp{\F}$ of a coherent sheaf $\F \in \coherent{X}$ is a closed subset of $X$, therefore the support of any complex $\F^\bullet$ of $\derb{X}$, being a finite union of closed sets, is closed as well.
\end{remark}

\begin{theorem}[\text{\cite[\S 3, Proposition 3.10]{huybrechts2006fouriermukai}}]
    \label{Db(X) indecomposable for X connected}
    The bounded derived category $\derb{X}$ of a connected scheme $X$ over $k$ is indecomposable.
\end{theorem}

\begin{proof}
    For the sake of contradiction, assume $\derb{X}$ decomposes into triangulated subcategories $\D_0$ and $\D_1$. We will first prove that the structure sheaf $\struct{X}$ belongs to either $\D_0$ or $\D_1$.
    By Proposition \ref{In a decomposable cat every object splits}, the  structure sheaf $\struct{X}$ is isomorphic to a direct sum $\F_0^\bullet \oplus \F_1^\bullet$, with complexes $\F_i^\bullet$ belonging to $\D_i$.
    % Then the structure sheaf $\struct{X}$ is isomorphic to a direct sum $\F_0^\bullet \oplus \F_1^\bullet$ with complexes $\F_i^\bullet$ belonging to $\D_i$ by Proposition \ref{In a decomposable cat every object splits}. 
    Since $\struct{X}$ clearly has cohomology supported only in degree $0$, the same is true for $\F_0^\bullet$ and $\F_1^\bullet$, thus, by Proposition \ref{A -> D(A) fully faithful}, we may replace them with coherent sheaves $\F_0$ and $\F_1$, respectively. By the same proposition this means that there is an isomorphism $\struct{X} \iso \F_0 \oplus \F_1$ in $\coherent{X}$. As the functor computing stalks of a sheaf at any given point $x \in X$ is exact, we obtain a direct sum decomposition $\OO_{X,x} \iso \F_{0,x} \oplus \F_{1,x}$, enabling us to write
    \[
        X = \supp{\struct{X}} = \supp{\F_0} \cup \supp{\F_1}.
    \]
    As $\F_i$ are coherent sheaves, their supports are closed in $X$, according to Remark \ref{supports closed}. Since $\OO_{X,x}$ is a local ring, and therefore \emph{indecomposable}\footnote{
        A ring $R$ is \emph{indecomposable} if it cannot be written in the form $R \iso I \oplus J$ for two non-zero $R$-modules $I$ and $J$. If such a decomposition exists, $I$ and $J$ can be identified with \emph{proper} ideals of $R$. Now assuming $R$ is local with a maximal ideal $\mathfrak{m}$, we end up with a contradiction $R \subseteq I + J \subseteq \mathfrak{m} \subsetneq R$.
        % which are necessarily cyclic. Letting $e$ denote the generator of $I \trianglelefteq R$ and $f$ the generator of $J \trianglelefteq R$, we see that from $I \cap J = 0 $, $e$ and $f$ are idempotents. For the decomposition is non-trivial $e$ and $f$ are non-zero. If we now assume $R$ is local, we arrive at a contradiction as  
        % generated respectively by a pair of orthogonal idempotents. If $R$ is assumed to be a local ring
        % is not isomorphic to a direct sum of two non-trivial $R$-modules. 
    }, for every $x \in X$, either $\F_{0,x} = 0$ or $\F_{1,x} = 0$, meaning $\supp{\F_0} \cap \supp{\F_1} = \varnothing$. By connectedness of $X$, it follows that either $\F_0 = 0$ or $\F_1 = 0$, thus, without loss of generality, we may assume that $\struct{X}$ belongs to $\D_0$. 

    Secondly picking any closed point $x \in X$, we see that $k(x)$ belongs to $\D_0$ as well. Indeed, as with $\struct{X}$, we may decompose $k(x)$ as $k(x) \iso \F_0 \oplus \F_1$ in $\coherent{X}$ for some coherent sheaves $\F_i$ belonging to $\D_i$. Then firstly $\supp{\F_i} \subset \{x\}$ and computing the stalk at $x$ shows either $\F_0$ or $\F_1$ is trivial. If $\F_1 = 0$, $k(x)$ belongs to $\D_0$, but if $\F_0 = 0$, then the isomorphism $k(x) \iso \F_1$ allows us to construct a non-zero homomorphism of sheaves $\struct{X} \to k(x) \to \F_1$,
    % \footnote{The morphism $\struct{X} \to k(x)$ comes from the morphism $\spec{k} \to X$, which includes the closed point $x$ into $X$.}
    contradicting orthogonality of $\D_0$ and $\D_1$. In the latter composition the morphism $\struct{X} \to k(x)$ comes from the morphism $\spec{k} \to X$, which includes the closed point $x$ into $X$.

    To finish off the proof, we now show that $\D_1$ contains only trivial objects. Suppose $\F^\bullet$ is an object of $\D_1$. If $\F^\bullet$ is not trivial, let $m \in \Z$ be maximal with the property $\mathcal H^m(\F^\bullet) \neq 0$. Then $\supp{\mathcal H^m(\F^\bullet)} \neq \varnothing$ and there is a \emph{closed} point $x \in X$, which is also contained in $\supp{\mathcal H^m(\F^\bullet)}$\footnote{
        If $x_0 \in \supp{\mathcal H}$ is not a closed point, consider it inside an affine open chart $U \iso \spec{A}$. Then $\supp{\mathcal H} \cap U$ corresponds in $\spec{A}$ to a non-empty closed subset of the form $V(I)$ for some ideal $I \trianglelefteq A$. Since every ideal $I$ is contained in some maximal ideal, we obtain a closed point of $V(I)$ in this way.
    }. As before this means there is a non-zero map $\mathcal H^m(\F^\bullet) \to k(x)$. Using this we will construct a non-zero morphism $\F^\bullet \to k(x)[m]$ in $\derb{X}$, once again contradicting orthogonality of $\D_0$ and $\D_1$. By \eqref{right truncation isos on cohomology}, we know the inclusion $\rtruncation{m}(\F^\bullet) \to \F^\bullet$ is a quasi-isomorphism. If we view $\mathcal H^m(\F^\bullet)$ 
    % in one of its equivalent ways 
    as $\coker(\F^{m-1} \to \ker d^m)$, we obtain a commutative diagram
    \[\begin{tikzcd}[row sep = small, column sep = small]
        % https://q.uiver.app/#q=WzAsMTIsWzQsMCwiXFxrZXIgZF5tIl0sWzYsMCwiMCJdLFs0LDIsIlxcbWF0aGNhbCBIXm0oXFxtYXRoY2FsIEZeXFxidWxsZXQpIl0sWzYsMiwiMCJdLFsyLDAsIlxcbWF0aGNhbCBGXnttLTF9Il0sWzIsMiwiMCJdLFsxLDAsIlxcY2RvdHMiXSxbMCwyLCJcXG1hdGhjYWwgSF5tKFxcbWF0aGNhbCBGXlxcYnVsbGV0KVttXToiXSxbMSwyLCJcXGNkb3RzIl0sWzcsMCwiXFxjZG90cyJdLFs3LDIsIlxcY2RvdHMiXSxbMCwwLCJcXHJ0cnVuY2F0aW9ue219XFxtYXRoY2FsIEZeXFxidWxsZXQ6Il0sWzIsM10sWzAsMV0sWzEsM10sWzAsMl0sWzQsMF0sWzQsNV0sWzUsMl0sWzYsNF0sWzgsNV0sWzEsOV0sWzMsMTBdXQ==
        {\rtruncation{m}(\mathcal F^\bullet)} & \cdots & {\mathcal F^{m-1}} && {\ker d^m} && 0 & \cdots \\
        \\
        {\mathcal H^m(\mathcal F^\bullet)[m]} & \cdots & 0 && {\mathcal H^m(\mathcal F^\bullet)} && 0 & \cdots,
        \arrow[from=1-2, to=1-3]
        \arrow[from=1-3, to=1-5]
        \arrow[from=1-3, to=3-3]
        \arrow[from=1-5, to=1-7]
        \arrow[from=1-5, to=3-5]
        \arrow[from=1-7, to=1-8]
        \arrow[from=1-7, to=3-7]
        \arrow[from=3-2, to=3-3]
        \arrow[from=3-3, to=3-5]
        \arrow[from=3-5, to=3-7]
        \arrow[from=3-7, to=3-8]
    \end{tikzcd}\]
    which gives rise to a chain map $\rtruncation{m}(\F^\bullet) \to \mathcal H^m(\F^\bullet)[m]$. The left roof \eqref{eq: contrived roof} below then represents a non-zero morphism $\F^\bullet \to k(x)[m]$ in $\derb{X}$, as it is clearly non-zero once the $m$-th cohomology functor is applied.
    \begin{equation}
        \label{eq: contrived roof}
        \F^\bullet \xleftarrow{\ \ \sim \ \ } \rtruncation{m}(\F^\bullet) \to \mathcal H^m(\F^\bullet) \to k(x)[m]
    \end{equation}
    As this cannot be so, $\F^\bullet$ has trivial cohomology making it and the category $\D_1$ trivial. This contradicts our initial assumption of $\D_0$ and $\D_1$ forming a decomposition of $\derb{X}$ and proves that $\derb{X}$ is indecomposable. 
\end{proof}

\subsubsection*{Serre functors}

Let $X$ be a smooth projective scheme over $k$. In order to define a Serre functor on $\derb{X}$ we first establish finite-dimensionality of its Hom-sets. 

\begin{proposition}
    \label{Db(X) has finite dimensional homs}
    Let $X$ be a projective variety over $k$.
    For any two bounded complexes $\E^\bullet$ and $\F^\bullet$ of $\derb{X}$ the Hom-set $\Hom_{\derb{X}}(\E^\bullet, \F^\bullet)$ is a finite dimensional $k$-vector space. 
\end{proposition}

The above proposition relies on a finiteness result of Serre found in \cite[\S III, Theorem 5.2]{Hartshorne1977}. As we will actually only need a very special case of this result, we also include a separate reference to the special case \cite[\S II, Theorem 5.19]{Hartshorne1977}.

\begin{theorem}
    \label{Serre finitness}
    \emph{\cite[\S III, Theorem 5.2]{Hartshorne1977}}
    Let $X$ be a projective variety over $k$ and $\F$ a coherent sheaf on $X$. Then $\cohom{i}{X}{\F}$ are finite dimensional $k$-vector spaces for all $i \in \Z$.
\end{theorem}

% \info{I actually need a reference for $Ext^i(\F, \G)$ are finite dimensional or $\localext{i}{\F}{\G}{}$ are coherent for $\F$, $\G$ coherent.}

\begin{proof}[Proof of Proposition \ref{Db(X) has finite dimensional homs}]
    % We will show that $\Ext^i_{\struct{X}}(\E^\bullet, \F^\bullet)$ is finite dimensional using spectral sequences \eqref{eq: Spectral sequence Ext 2} and \eqref{eq: Spectral sequence Ext 1}.
    % For this proof we will momentarily borrow 
    Since $\derb{X} \to \derb{\quasicoh{X}}$ is fully faithful and $\quasicoh{X}$ contains enough injectives, Proposition \ref{Homs in derived category}, tells us that
    \[
        \Hom_{\derb{X}}(\E^\bullet, \F^\bullet) \iso \Ext^0_{\struct{X}}(\E^\bullet, \F^\bullet) = H^0(\Hom^\bullet_{\struct{X}}(\E^\bullet, \F^\bullet)).
    \]
    Recall that $\Hom^i_{\struct{X}}(\E^\bullet, \F^\bullet) = \bigoplus_{j \in \Z} \Hom_{\struct{X}}(\E^j, \F^{i+j})$, where the direct sum is actually finite due to $\E^\bullet$ and $\F^\bullet$ being bounded complexes. Momentarily borrowing the internal Hom of two sheaves from Section \ref{Subsubsection: Internal Hom}, \cite[II, \S 9, Proposition 9.1.1]{EGA} lets us state that the internal Hom of two coherent sheaves is again coherent.
    % From \cite[\href{https://stacks.math.columbia.edu/tag/01CQ}{Tag 01CQ}]{stacks-project}, 
    % we see that the internal Hom of two coherent sheaves is again coherent, 
    Thus for any two coherent sheaves $\F$ and $\G$ the module of global sections $\Gamma(X, \localhom_{\struct{X}}(\F, \G)) = \Hom_{\struct{X}}(\F, \G)$ is finite dimensional by Theorem \ref{Serre finitness}. In turn this implies $\Hom^i_{\struct{X}}(\E^\bullet, \F^\bullet)$ are finitely dimensional $k$-vector spaces for all $i \in \Z$, meaning $H^0(\Hom^\bullet_{\struct{X}}(\E^\bullet, \F^\bullet))$ is finite dimensional as well. 
\end{proof}

Recall that for a smooth and projective scheme $X$ over $k$ of dimension $n$, Serre duality \cite[\S III, Theorem 7.6]{Hartshorne1977} states that for any coherent sheaf $\F$ on $X$ there is an isomorphism
\begin{equation}
    \label{eq: Classic Serre duality}
    \Ext_{\struct{X}}^{n-i}(\F, \omega_X) \iso \cohom{i}{X}{\F}^*,
\end{equation}
where $\omega_X$ denotes the canonical bundle of $X$, \ie the $n$-th exterior power of the sheaf of Kähler differentials, $\omega_X = \bigwedge^n \Omega_X$. Generalizing Serre's duality theorem for smooth projective schemes over $k$ to the context of complexes leads us to define Serre functors. This also clarifies why we called such functors \emph{Serre functors} already in Section \ref{Subsection: Triangulated categories}, where no geometry was present. 

\begin{definition}
    \label{Serre functor on Db(X)}
    For a smooth and projective variety $X$ over $k$ define the \emph{Serre functor} $S_X \colon \derb{X} \to \derb{X}$ to be the composition
    \[
        S_X = (-) \otimes_\struct{X} \omega_X[\dim X].
    \]
\end{definition}

\begin{remark}
    This remark serves as a quick justification, why $S_X$ may be defined in this way. The canonical bundle $\omega_X$ is a line bundle, thus in particular flat, so the $k$-linear functor $(-) \otimes_\struct{X} \omega_X \colon \coherent{X} \to \coherent{X}$ is exact. The induced homotopy functor $\kb{\coherent{X}} \to \kb{\coherent{X}}$ then satisfies the conditions of Lemma \ref{F preserves qis iff preserves acyclic} and therefore induces a triangulated functor
    \[
        (-) \otimes_\struct{X} \omega_X \colon \derb{X} \to \derb{X}
    \]
    by Proposition \ref{Exact functor induces a derived functor}.
    The Serre functor $S_X$ is then obtained by composing the latter functor with the translation functor $\dim X$ times. 
    
    % formally induced by the triangulated functor on the homotopy category $\kb{X}$ given by tensoring with the canonical bundle $\omega_X$. 
\end{remark}

\begin{theorem}[Serre duality for derived categories, \text{\cite[\S 3.4, Remark 3.37]{huybrechts2006fouriermukai}}]
    \label{Serre duality for derived cats}
    Let $X$ be a smooth projective variety over a field $k$ and let $\E^\bullet$ and $\F^\bullet$ belong to $\derb{X}$. The functor $S_X$ is a Serre functor in the sense of Definition \ref{Definiton of Serre functor}, \ie there is an isomorphism
    \[
        \Hom_{\derb{X}}(\F^\bullet, \E^\bullet) \iso \Hom_{\derb{X}}(\E^\bullet, S_X(\F^\bullet))^*,
    \]
    which is natural in $\E^\bullet$ and $\F^\bullet$.
\end{theorem}

\begin{proof}
    See \cite[\S 3.4, Remark 3.37]{huybrechts2006fouriermukai} for an elegant proof using Grothendieck--Verdier duality. One is able to derive this version of Serre duality also from the classical one \eqref{eq: Classic Serre duality}. 
    % This will follow as a corollary of Grothendieck-Verdier duality \ref{}.
\end{proof}

% We will use Serre duality for example to help us prove 

\subsubsection*{A spanning class}

Suppose $X$ is a variety over an algebraically closed field $k$ and let $x \in X$ be a closed point. Then we know it is a $k$-point and there is a corresponding morphism of schemes over $k$, namely $x \colon \spec{k} \to X$. We define the skyscraper sheaf $k(x)$ to be the push-forward of the structure sheaf $\struct{\spec{k}}$ along the map $x$, 
\[
    k(x) := x_* \struct{\spec{k}}.
\]
The set of all such skyscrapers will turn out to form a spanning class for the triangulated category $\derb{X}$, when $X$ is smooth and projective.
The following proposition can be found in \cite[\S 3, Proposition 3.17]{huybrechts2006fouriermukai} or in Bridgeland's paper \cite[Example 2.2]{bridgeland2019equivalencestriangulatedcategoriesfouriermukai}. As we shall see, it is proven by a very neat application of the spectral sequence \eqref{eq: Spectral sequence derived hom 1}.

\begin{proposition}
    \label{k(x) spanning class}
    \emph{\cite[Example 2.2]{bridgeland2019equivalencestriangulatedcategoriesfouriermukai}}
    Suppose $X$ is a smooth projective variety over $k$. The set of all skyscraper sheaves $k(x)$, for closed points $x \in X$, forms a spanning class of the bounded derived category $\derb{X}$.
\end{proposition}

\begin{proof}
    By virtue of contradiction we will show that for any non-trivial complex $\F^\bullet$ of $\derb{X}$ there are closed points $x_0$, $x_1 \in X$ and integers $i_0$, $i_1 \in \Z$, for which
    \[
        \Hom_{\derb{X}}(\F^\bullet, k(x_0)[i_0]) \neq 0 \quad \text{and} \quad \Hom_{\derb{X}}(k(x_1), \F^\bullet[i_1]) \neq 0.
    \] 
    By Serre duality \ref{Serre duality for derived cats}, we see it suffices to find only $x_0$ and $i_0$, since
    \begin{align*}
        \Hom_{\derb{X}}(k(x_1), \F^\bullet[i_1]) 
        &\iso \Hom_{\derb{X}}(\F^\bullet[i_1], k(x) \otimes_{\struct{X}} \omega_X[\dim X])^* \\
        &\iso \Hom_{\derb{X}}(\F^\bullet, k(x)[\dim X - i_1])^*. 
    \end{align*}
    As $\F^\bullet$ is non-trivial, let $m \in \Z$ be maximal with the property that $\mathcal{H}^m(\F^\bullet) \neq 0$. As in the proof of Theorem \ref{Db(X) indecomposable for X connected}, pick a closed point in the non-empty support of $\mathcal H^m(\F^\bullet)$, for which we then know there is a non-zero morphism $\mathcal H^m(\F^\bullet) \to k(x)$ in $\derb{X}$. Consider now the spectral sequence \eqref{eq: Spectral sequence derived hom 1}
    \[
        E^{p,q}_2 = \Hom_{\derb{X}}(\mathcal H^{-q}(\F^\bullet), k(x)[p]) \Rightarrow \Hom_{\derb{X}}(\F^\bullet, k(x)[p+q]) = E^{p+q}.  
    \] 
    This is a spectral sequence lying in the right half plane, since $E^{p,q}_2 = 0$ for $p < 0$ as negative $\Ext$-modules are always trivial. A portion of the second page of the spectral sequence is depicted below.
    \vspace{0.2cm}
    \[\begin{tikzcd}[column sep = 1em, row sep = 0.5em]
        % https://q.uiver.app/#q=WzAsMjAsWzIsMiwiKiJdLFsxLDIsIkVeezAsIC1tfV8yIl0sWzMsMiwiKiJdLFsxLDEsIioiXSxbMiwxLCIqIl0sWzMsMSwiKiJdLFsxLDAsIioiXSxbMiwwLCIqIl0sWzMsMCwiKiJdLFswLDAsIjAiXSxbMCwxLCIwIl0sWzAsMiwiMCJdLFswLDMsIjAiXSxbMSwzLCIwIl0sWzIsMywiMCJdLFszLDMsIjAiXSxbMiw0LCIwIl0sWzMsNCwiMCJdLFswLDQsIjAiXSxbMSw0LCIwIl0sWzksMV0sWzEsMTZdXQ==
        0 & {*} & {*} & {*} \\
        0 & {*} & {*} & {*} \\
        0 & {E^{0, -m}_2} & {*} & {*} \\
        0 & 0 & 0 & 0 \\
        0 & 0 & 0 & 0
        \arrow[from=1-1, to=3-2]
        \arrow[from=3-2, to=5-3]
    \end{tikzcd}\]
    % \vspace{0.2cm}
    
    The highlighted arrows are the two trivial differentials, mapping into and out of $E^{0,-m}_2$, meaning that $E^{0,-m}_3$ is isomorphic to $E^{0,-m}_2$, thus also non-trivial. The same may be deduced for the $(0,-m)$-th term of each page, allowing us to conclude that $E^{0,-m}_\infty$ is non-trivial. The filtration for $E^{-m} = \Hom_{\derb{X}}(\F^\bullet, k(x)[-m])$ therefore contains a non-trivial intermediary quotient, making it itself non-trivial and proving our claim. 
\end{proof}

% \info{Grothendieck's vanishing results and Serre's finitness}

\subsection{Derived functors in algebraic geometry}
\label{Subsection: Derived functors in geometry}

In this section we will derive some functors occurring in algebraic geometry 
% and later state some important facts relating them with each other. 
To derive these functors we will pursue one of the two following options. Either deal with injective sheaves and access the realm of quasi-coherent sheaves, following the first part of Subsection \ref{Subsubsection: Derived functors of left exact functors}, or introduce certain special classes of coherent sheaves depending on the functor we wish to derive, which are going to take the role of adapted classes, mirroring what was done in the second part of that subsection.

\subsubsection{Global sections functor}
Arguably the most common functor in algebraic geometry is the \emph{global sections functor}. Associated to a noetherian scheme $X$, the functor of global sections
\[
    \Gamma \colon \mod{\OO_X} \to \mod{k}
\]
assigns to each $\OO_X$-module $\F$ its module of global sections $\F(X) = \Gamma(X, \F) = H^0(X, \F)$ and to a morphism of $\OO_X$-modules $\alpha\colon \F \to \G$ a homomorphism $\alpha_X \colon \F(X) \to \G(X)$.
By abuse of notation we use $\Gamma$ to also denote the restrictions of the global sections functor to subcategories $\quasicoh{X}$ and $\coherent{X}$ of $\mod{\OO_X}$. When we want to emphasise that $\Gamma$ is associated to a scheme $X$, we write $\Gamma(X, -)$ to denote the global sections functor on $X$.

As is commonly known, $\Gamma$ is a left exact functor, so our aim is to construct its right derived counterpart. Due to $\coherent{X}$ not having enough injectives, we resort to $\quasicoh{X}$\footnote{The scheme $X$ is noetherian, so $\quasicoh{X}$ contains enough injectives by Proposition \ref{qcoh of noetherian scheme contains enough injectives}}, on which we may define 
\[
    \rderived{}{\Gamma}\colon \derplus{\quasicoh{X}} \to \derplus{\mod{k}},
\]
according to method 1 of Subsection \ref{method 1}. Precomposing the latter functor with the inclusion $\derplus{\coherent{X}} \to \derplus{\quasicoh{X}}$ leaves us with the derived functor
\[
    \rderived{}{\Gamma} \colon \derplus{\coherent{X}} \to \derplus{\mod{k}}.
\]
Utilizing the cohomology functors, we obtain higher derived functors of $\Gamma$, denoted by
\[
    \rderived{i}{\Gamma} = \cohom{i}{X}{-},
\]
for $i \in \Z$. Applied to a complex of sheaves $\F^\bullet$ the resulting modules $\rderived{i}{\Gamma}(\F^\bullet) = H^i(X, \F^\bullet)$ are sometimes called the \emph{hypercohomology modules} of $\F^\bullet$.
% Higher derived functors of $\rderived{}{\Gamma}$ are denoted by $\rderived{i}{\Gamma}$ and sometimes also called the \emph{hypercohomology}. Applied to a 
% \[
%     \rderived{i}{\Gamma} = \cohom{i}{X}{-}.
% \]
Plugging in just a single coherent sheaf $\F$, we get the familiar \emph{sheaf cohomology} of $X$ with respect to a sheaf $\F$, denoted with $\cohom{i}{X}{\F}$. 

\begin{example}
    \label{LES in cohomology of SES of coherent sheaves}
    As a nice application of the abstract machinery of Chapter \ref{Chapter: Derived categories} we obtain the famous long exact sequence in cohomology 
    \begin{multline}
        \label{eq: LES in cohomology of SES of coherent sheaves}
        0 \to \cohom{0}{X}{\E} \to \cohom{0}{X}{\F} \to \cohom{0}{X}{\G} \to \cohom{1}{X}{\E} \to \cohom{1}{X}{\F} \to \cdots \\
        \cdots \to \cohom{i}{X}{\E} \to \cohom{i}{X}{\F} \to \cohom{i}{X}{\G} \to \cohom{i+1}{X}{\E} \to \cdots 
    \end{multline}
    associated to a short exact sequence of coherent sheaves $0 \to \E \to \F \to \G \to 0$. This is an immediate corollary of Proposition \ref{LES for right derived functor}.
\end{example}

The above definition of $\rderived{}{\Gamma}$ will suffice for most cases, but we can go slightly further, utilizing a vanishing result of Grothendieck, to be found in \cite[\S III, Theorem 2.7]{Hartshorne1977}.

\begin{theorem}
    \label{Grothendieck vanishig}
    \emph{\cite[\S III, Theorem 2.7]{Hartshorne1977}}
    Let $\F$ be a quasi-coherent sheaf on a noetherian scheme $X$ of dimension $n$. Then $H^i(X, \F) = 0$ for all $i > n$.
\end{theorem}
\noindent
If $X$ is a noetherian scheme of dimension $n$, the modules $\rderived{i}{\Gamma}(\F)$ are non-trivial only for finitely many $i \in \Z$, for any coherent sheaf $\F$. By Proposition \ref{Spectral sequences for derived cats} \ref{Bounded on objects implies bounded on complexes} we thus obtain a functor
\[
    \rderived{}{\Gamma} \colon \derb{X} \to \derb{\mod{k}}.
\]


\subsubsection{Push-forward $f_*$}
A generalization of the global sections functor is the \emph{push-forward} or the \emph{direct image} functor along a morphism of schemes $f \colon X \to Y$. The \emph{push-forward} functor
\[
    f_* \colon \mod{\struct{X}} \to \mod{\struct{Y}}
\]
is defined on objects by assigning an $\struct{X}$-module $\F$ the $\struct{Y}$-module $f_*\F$ defined on open subsets $V \subseteq Y$ to be $(f_*\F)(V) = \F(f\inv(V))$ with the obvious restriction homomorphisms of $\F$. On a morphism $\alpha \colon \F \to \G$ of $\struct{X}$-modules, $f_*$ is defined to act as $(f_*\alpha)_V = \alpha_{f\inv(V)}$ for all open $V \subseteq Y$. 

We are going to strengthen our initial assumption that our schemes are noetherian to them being of finite type over $k$ 
% Within the class of varieties over $k$ this assumption is satisfied by definition. 
and consider only morphisms $f \colon X \to Y$ between schemes of this kind. 
To induce a functor between the quasi-coherent and coherent categories of $X$ and $Y$, we need to recall the following proposition first.

\begin{proposition}
    \label{push-forward of coherent and quasi coherent shaves}
    \emph{\cite{Hartshorne1977,EGA}}
    Let $f \colon X \to Y$ be a morphism of schemes of finite type over $k$. Then for every quasi-coherent sheaf $\F$ on $X$, $f_*\F$ is quasi-coherent on $Y$. If $f$ is assumed to be projective, or more generally, proper and $\F$ is coherent on $X$, then $f_*\F$ is coherent on $Y$.
\end{proposition}

\begin{proof}
    The quasi-coherent part is \cite[\S II, Proposition 5.8]{Hartshorne1977}, because schemes of finite type over $k$ are noetherian. For the coherent part see \cite[\S II, Proposition 5.20]{Hartshorne1977} in the case that $f$ is projective and \cite[Part III, \S 3.2, Theorem 3.2.1]{EGA}, when $f$ is proper.
\end{proof}

It is a well-known fact that $f_*$ is left exact, because it is a right adjoint and right adjoints preserve limits. As $\quasicoh{X}$ contains enough injectives, we may right derive $f_*$ to obtain 
\[
    \rderived{}{f_*} \colon \derplus{\quasicoh{X}} \to \derplus{\quasicoh{Y}}.
\]
This allows us to introduce the higher derived direct image functors
\[
    \rderived{i}{f_*} = \mathcal H^i \circ \rderived{}{f_*}
\] 
for all $i \in \Z$.

Next, we would like to introduce the derived push-forward also between the \emph{bounded} derived categories of quasi-coherent sheaves. The next proposition will enable us to do so. 

\begin{proposition}
    Let $f \colon X \to Y$ be a morphism of schemes of finite type over $k$ and let $\F$ be a coherent sheaf on $X$. Then $\rderived{i}{f_*}\F \iso 0$ for all $i > n$, where $n$ is the dimension of $X$.
\end{proposition}

\begin{proof}
    Let $\F \to \I^\bullet$ be an injective resolution of $\F$ and let $\delta$ denote the differential of $\I^\bullet$. Then 
    \[
        \rderived{i}{f_*}\F = \mathcal H^i(\rderived{}{f_*}\F) = \mathcal H^i (f_*\I^\bullet) = \coker(\im(f_*\delta^{i-1}) \to \ker(f_*\delta^i)).
    \]
    We recognise the cokernel at the end as the sheafification of the presheaf described on open subsets of $X$ by the assignment
    \begin{equation}
        \label{eq: presheaf of higher derived direct image functor}
        V \mapsto \coker(\im(\delta^{i-1}_{f\inv(V)}) \to \ker(\delta^i_{f\inv(V)})).
    \end{equation}
    For every open $V \subseteq Y$, the open subset $f\inv(V)$ determines a noetherian subscheme of $Y$ whose dimension is at most $n$. Therefore, by Grothendieck's vanishing Theorem \ref{Grothendieck vanishig}, the presheaf given by \eqref{eq: presheaf of higher derived direct image functor} is trivial for $i > n$, because 
    \begin{align*}
        \coker(\im(\delta^{i-1}_{f\inv(V)}) \to \ker(\delta^i_{f\inv(V)})) &= H^i(\Gamma(f\inv(V), \I^\bullet)) = \\
        &= \rderived{i}{\Gamma(f\inv(V), \I^\bullet)} \iso \cohom{i}{f\inv(V)}{\F}.
        \qedhere
    \end{align*} 
\end{proof}

\noindent
Applying Proposition \ref{Spectral sequences for derived cats} \ref{Bounded on objects implies bounded on complexes}, we may induce the derived direct image functor
\begin{equation}
    \label{eq: derived direct image on bounded quasicoherent derived cats}
    \rderived{}{f_*} \colon \derb{\quasicoh{X}} \to \derb{\quasicoh{Y}}.
\end{equation}
Finally, we obtain the derived direct image functor between the bounded derived categories of coherent sheaves formulated in the following proposition.
\begin{proposition}
    \label{push-forward on Db(X)}
    Let $f \colon X \to Y$ be a proper morphism between schemes $X$ and $Y$ of finite type over $k$. Then the derived direct image functor \eqref{eq: derived direct image on bounded quasicoherent derived cats} induces
    \[
        \rderived{}{f_*} \colon \derb{X} \to \derb{Y}.
    \]
\end{proposition} 

\begin{proof}
    By \cite[Part III, \S 3.2, Theorem 3.2.1]{EGA} all the higher direct images $\rderived{i}{f_*}\F$ of a coherent sheaf $\F$ are again coherent. As the category of coherent sheaves $\coherent{X}$ is thick in $\quasicoh{X}$, according to \cite[\S II, Proposition 5.7]{Hartshorne1977}, Proposition \ref{Spectral sequences for derived cats} \ref{Cohomology in a thick subcategory} tells us that the derived direct image $\rderived{}{f_*}\F^\bullet$ has coherent cohomology for any complex $\F^\bullet$ of $\derb{X}$. Functor $\rderived{}{f_*}$ thus maps complexes of $\derb{X}$ to complexes of $\mathsf{D}^b_{\mathsf{coh}}(\quasicoh{Y})$, inducing
    \[
        \rderived{}{f_*} \colon \derb{X} \to \derb{Y},
    \]
    by Proposition \ref{Db(X) is bounded derived of quasi-coherent with coherent cohomology}.
\end{proof}

\begin{remark}
    Whenever $f \colon X \to Y$ is an isomorphism of schemes of finite type over $k$, the push-forward functor $f_* \colon \coherent{X} \to \coherent{Y}$ is an equivalence of categories. Therefore it also induces an equivalence on the level of derived categories $\derb{X} \to \derb{Y}$.
    This nearly obvious but nonetheless important observation shows that $\derb{-}$ is an invariant of the isomorphism class of a scheme of finite type over $k$. 
\end{remark}

\begin{example}
    An example of a direct image functor we will encounter very often is pushing-forward along a projection $p \colon X \times Y \to X$ for smooth and projective varieties $X$ and $Y$ over a field $k$. In this case the projection $p$ is proper because the properness condition is stable under base change \cite[\href{https://stacks.math.columbia.edu/tag/01W4}{Tag 01W4}]{stacks-project} and the structure map $Y \to \spec{k}$ of a projective variety $Y$ is by definition proper. 
\end{example}

\subsubsection{Hom functors}
\label{Subsubsection: Internal Hom}

Let $X$ be a noetherian scheme over a field $k$. For any two quasi-coherent sheaves $\F$ and $\G$ on $X$, we denote with $\Hom_{\struct{X}}(\F, \G)$ the $k$-vector space of morphisms in the abelian category $\quasicoh{X}$. As with any category it gives rise to a functor
\[
    \Hom_{\struct{X}}(\F, -) \colon \quasicoh{X} \to \mod{k}
\]
for any quasi-coherent sheaf $\F$ on $X$. Since $\quasicoh{X}$ contains enough injectives by Proposition \ref{qcoh of noetherian scheme contains enough injectives}, we can derive this Hom functor according to Section \ref{subsection: Ext functors} to obtain
\[
    \rderived{}{\Hom_{\struct{X}}(\F, -)} \colon \derplus{\quasicoh{X}} \to \derplus{\mod{k}}.
\]
In this way we also obtain all its higher derived functors, namely the \emph{Ext-functors}
\[
    \Ext_{\struct{X}}^i(\F, -) = \rderived{i}{\Hom_{\struct{X}}(\F, -)}
\]
for all $i \in \Z$.


\subsubsection*{Internal Hom}

The \emph{internal Hom} or \emph{sheaf Hom} of two sheaves $\F$ and $\G$ on $X$ is defined to be a sheaf on $X$ given on open sets $U \subseteq X$ by
\[
    U \mapsto \Hom_{\struct{U}}(\F|_U, \G|_U),
\]
with the restriction homomorphisms being the usual restrictions of homomorphisms of sheaves. When $\F$ and $\G$ are taken to be $\struct{X}$-modules, the internal Hom may also be equipped with an $\struct{X}$-action making it an $\struct{X}$-module. We denote it by $\localhom_{\struct{X}}(\F, \G)$ when we want to clarify that we are working over a base space $X$ and $\localhom(\F, \G)$ otherwise. Applying the global sections functor $\Gamma(X, -)$ to $\localhom(\F, \G)$ it is clear that
\[
    \Gamma(X, \localhom(\F, \G)) = \Hom_{\struct{X}}(\F, \G).
\]
The internal Hom also defines a bifunctor
\begin{equation}
    \label{eq: internal hom on O_X-modules}
    \localhom(-, -) \colon \mod{\struct{X}}^\op \times \mod{\struct{X}} \to \mod{\struct{X}}.
\end{equation}
For a fixed $\struct{X}$-module $\G$ the $\localhom(-, \G)$-action on a homomorphism of $\struct{X}$-modules ${\alpha \colon \F_1 \to \F_0}$ is defined as the $\struct{X}$-module homomorphism
\[
    \alpha^* \colon \localhom(\F_0, \G) \to \localhom(\F_1, \G),
\]
given on open subsets $U \subseteq X$ by $\Gamma(U, \struct{X})$-linear maps
\[
    (\alpha^*)_U = \left(\Hom_{\struct{U}}(\F_0|_U, \G|_U) \xrightarrow{(\alpha_U)^*} \Hom_{\struct{U}}(\F_1|_U, \G|_U)\right).
\]
This action is clearly functorial and the same may be said for the similarly defined $\localhom(\F, -)$-action, for a fixed $\struct{X}$-module $\F$. By \cite[II, \S 9, Proposition 9.1.1]{EGA} the sheaf $\localhom_{\struct{X}}(\F, \G)$ is coherent for any two coherent sheaves $\F$ and $\G$ on $X$. Therefore \eqref{eq: internal hom on O_X-modules} may be restricted to a bifunctor
\[
    \localhom(-, -) \colon \coherent{X}^\op \times \coherent{X} \to \coherent{X}.
\]
% By Remark \ref{} 


% \[
%     \rderived{}{\localhom^\bullet(-, -)} \colon \derb{X}^\op \times \derb{X} \to \derb{X}
% \]

Analogous to the Hom complex of Section \ref{subsection: Ext functors} (Definition \ref{definition of Hom complex}) we can also define the following complex. Let $\F^\bullet$ and $\G^\bullet$ be bounded complexes of coherent sheaves on $X$. The \emph{internal Hom complex} $\localhom^\bullet(\F^\bullet, \G^\bullet)$ is then defined by its terms
\[
    \localhom^i(\F^\bullet, \G^\bullet) = \bigoplus_{j \in \Z} \localhom(\F^{j}, \G^{i+j})
\]
and differentials
\[
    \delta^i \colon \localhom^i(\F^\bullet, \G^\bullet) \to \localhom^{i+1}(\F^\bullet, \G^\bullet),
\]
which one can formally described as follows. Let $\pi_j \colon \localhom^i(\F^\bullet, \G^\bullet) \to \localhom(\F^{j}, \G^{i+j})$ denote the canonical projection onto the $j$-th component. Then $\delta^i$ is the unique map obtained by the universal property of the product $\localhom^{i+1}(\F^\bullet, \G^\bullet)$, induced by the family of morphisms
\[
    (d_{\G}^{i+j})_*\circ \pi_j + (-1)^i(d_\F^{j})^*\circ \pi_{j+1} \colon \quad  \localhom^i(\F^\bullet, \G^\bullet) \to \localhom(\F^{j}, \G^{i+j+1}).
\]
Not very different from how we showed in Section \ref{subsection: Ext functors} that the Hom complex induces a functor or even a bifunctor according to Remark \ref{bifunctors on the homotopy category}, we obtain a bifunctor 
\[
    \localhom^\bullet \colon \kminus{\coherent{X}}^\op \times \kplus{\coherent{X}} \to \kplus{\coherent{X}}.
\] 
When $X$ is smooth and projective and Proposition \ref{In Db(X) everything is a complex of vector bundles} is at ones disposal, it is possible to derive the internal Hom complex functor above to obtain a bifunctor
\[
    \rderived{}{\localhom^\bullet}(-,-) \colon \derb{X}^\op \times \derb{X} \to \derb{X}.
\]  
The main ingredients for how one goes about proving the above are described in \cite[75--77]{huybrechts2006fouriermukai}. On this note we also mention that Proposition \ref{In Db(X) everything is a complex of vector bundles} greatly simplifies how we compute
%  values of the functor 
$\rderived{}{\localhom^\bullet}(\F^\bullet,-)$ for some complex $\F^\bullet$ from $\derb{X}$. This is because $\F^\bullet$ can be replaced by an isomorphic (in $\derb{X}$) complex $\E^\bullet$ of vector bundles, for which $\rderived{}{\localhom^\bullet(\E^\bullet, -)}$ and $\localhom^\bullet(\E^\bullet, -)$ coincide. The \emph{dual} of a complex $\F^\bullet$ of $\derb{X}$ will be taken to be 
\[
    {\F^\bullet}^\vee := \rderived{}{\localhom}(\F^\bullet, \struct{X}).
\]
In general, even if $\F^\bullet$ is just a coherent sheaf concentrated in degree $0$, its dual may be an honest complex.

% We also establish notation ${\F^\bullet}^\vee$ to 

% For any complex $\F^\bullet$ belonging to $\derminus{X}$ one is then able to obtain by similar reasoning as in Section \ref{subsection: Ext functors} the following derived functor
% \[
%     \rderived{}{\localhom(\F^\bullet, -)} \colon \derb{X} \to \derb{X}
% \]



% In practice we will always be dealing with smooth projective varieties, so Proposition \ref{In Db(X) everything is a complex of vector bundles} will be at our disposal. 

\subsubsection{Tensor product}

For two $\struct{X}$-modules $\F$ and $\G$ their \emph{tensor product} $\F \otimes_{\struct{X}} \G$ is defined as the sheafification of the presheaf given on open subsets $U \subseteq X$ by
\[
    U \mapsto \Gamma(U, \F) \otimes_{\Gamma(U, \struct{X})} \Gamma(U, \G).
\] 
Using this description $\F \otimes_{\struct{X}} \G$ is equipped with the $\struct{X}$-action in the obvious way making it into an $\struct{X}$-module. Moreover this definition is functorial in both arguments $\F$ and $\G$ in the sense that a morphism of $\struct{X}$-modules $\alpha \colon \F_0 \to \F_1$ induces a morphism ${\alpha \otimes \id{\G} \colon} \F_0 \otimes_{\struct{X}} \G \to \F_1 \otimes_{\struct{X}} \G $ in a functorial way. The morphism $\alpha \otimes \id{\G}$ comes from the universal property of sheafification, such that for every open subset $U \subseteq X$ we have a commutative diagram
\[
    \begin{tikzcd}[column sep = 1.5em]
        % https://q.uiver.app/#q=WzAsNCxbMCwwLCJLKFxcQSkiXSxbMiwwLCJLKFxcQikiXSxbMCwyLCJEKFxcQSkiXSxbMiwyLCJEKFxcQikiXSxbMCwxLCJGIl0sWzAsMl0sWzIsM10sWzEsM11d
        {\Gamma(U, \F_0) \otimes_{\Gamma(U, \struct{X})} \Gamma(U, \G)} && {\Gamma(U, \F_0 \otimes_{\struct{X}} \G)} \\
        \\
        {\Gamma(U, \F_1) \otimes_{\Gamma(U, \struct{X})} \Gamma(U, \G)} && {\Gamma(U, \F_1 \otimes_{\struct{X}} \G)}
        \arrow["", from=1-1, to=1-3]
        \arrow["{\alpha_U \otimes (\id{\G})_U}"', from=1-1, to=3-1]
        \arrow["{(\alpha \otimes \id{\G})_U}", dashed, from=1-3, to=3-3]
        \arrow["", from=3-1, to=3-3]
    \end{tikzcd}
\]
In exactly the same way one also sees that the tensor product is functorial in the other variable. Hence the tensor product assembles a bifunctor
\[
    (-) \otimes_{\struct{X}} (-) \colon \mod{\struct{X}} \times \mod{\struct{X}} \to \mod{\struct{X}}.
\]
According to \cite[\href{https://stacks.math.columbia.edu/tag/01CE}{Tag 01CE}]{stacks-project} tensor product of two coherent sheaves is again coherent, so we also have a bifunctor 
\[
    (-) \otimes_{\struct{X}} (-) \colon \coherent{X} \times \coherent{X} \to \coherent{X}.
\]
Partially evaluating this functor at a coherent sheaf $\F$ on $X$ gives a functor ${\F \otimes_{\struct{X}} (-) \colon}$ $ \coherent{X} \to \coherent{X}$, which we know is left exact (for example due to the tensor-Hom adjunction \cite[\href{https://stacks.math.columbia.edu/tag/01CN}{Tag 01CN}]{stacks-project}). We also mention that tensor product commutes with the stalks functor \cite[\href{https://stacks.math.columbia.edu/tag/01CB}{Tag 01CB}]{stacks-project}, meaning that for any $x \in X$ there are natural isomorphisms
\[
    (\F \otimes_{\struct{X}} \G)_x \iso \F_x \otimes_{\struct{X,x}} \G_x.
\]
In order to derive the functor $\F \otimes_{\struct{X}} (-)$, we need an adapted class, which is provided by the following proposition.

\begin{proposition}
    \label{vector bundles adapted to tensor product}
    Let $X$ be a smooth projective variety and $\F$ a coherent sheaf on $X$. Then the class of vector bundles on $X$ forms a $\F \otimes_{\struct{X}} (-)$-adapted class.
\end{proposition}

\begin{proof}
    The class of vector bundles is obviously closed under finite direct sums and we already know that every coherent sheaf is a quotient of some vector bundle. Thus it remains to show that given an acyclic complex of vector bundles $\E^\bullet$, which is bounded from above, the tensor product $\F \otimes \E^\bullet$ is again acyclic. This is verified on stalks, where localizing at a point $x \in X$ gives
    \[
        \cdots \to \F_x \otimes_{\struct{X,x}} \E^{i-1}_x \to \F_x \otimes_{\struct{X,x}} \E^{i}_x \to \F_x \otimes_{\struct{X,x}} \E^{i+1}_x \to \cdots.
    \]
    This complex is acyclic, because the complex $\E^{\bullet}_x$ is acyclic and consists of free $\struct{X,x}$-modules.
\end{proof}

On a smooth projective variety $X$ Proposition \ref{vector bundles adapted to tensor product} allows us to derive $\F \otimes_{\struct{X}} (-)$ and obtain the left derived tensor product functor
\[
    \derivedtensor{\F}{(-)}{\struct{X}} \colon \derminus{X} \to \derminus{X}.
\]
Along with it also come its higher derived companions, called the \emph{internal Tor sheaves}
\[
    \localtor{i}{\F}{\G}{{\struct{X}}} = \mathcal{H}^{-i}(\derivedtensor{\F}{\G}{\struct{X}}).
\] 

Generalizing the tensor product of sheaves, we can define also a tensor product of complexes of sheaves in an analogous way to what was done with the internal Hom complex. For bounded complexes $\F^\bullet$ and $\G^\bullet$ of coherent sheaves on $X$ we introduce the \emph{internal tensor complex} $\F^\bullet \otimes_{\struct{X}} \G^\bullet$ to consist of terms
\[
    (\F^\bullet \otimes_\struct{X} \G^\bullet)^i = \bigoplus_{p + q = i} \F^p \otimes_{\struct{X}} \G^q
\]
and differentials $\delta^i \colon (\F^\bullet \otimes_\struct{X} \G^\bullet)^i \to (\F^\bullet \otimes_\struct{X} \G^\bullet)^{i+1}$ formally described as the unique map induced by the family of morphisms, indexed by $p$, $q$, satisfying $p + q = i+1$
\[
    (d_\F^{p-1} \otimes \id{\G^q})\circ \pi_{p-1,q} + (-1)^i(\id{\F^p} \otimes d_{\G}^{q-1})\circ \pi_{p,q-1} \colon \quad (\F^\bullet \otimes_\struct{X} \G^\bullet)^i \to \F^p \otimes_{\struct{X}} \G^q
\]
by universal property of the product $(\F^\bullet \otimes_\struct{X} \G^\bullet)^{i+1}$. Here $\pi_{p,q}$ denote the canonical projections $(\F^\bullet \otimes_\struct{X} \G^\bullet)^i \to \F^p \otimes_{\struct{X}} \G^q$ for $p + q = i$.

The contents of \cite[79--80]{Huybrechts2016} allow us to first form a bifunctor out of the internal tensor complex and provided we are working over a smooth projective variety $X$ derive it into a bifunctor
\[
    \derivedtensor{(-)}{(-)}{\struct{X}} \colon \derb{X} \times \derb{X} \to \derb{X}.
\]
We remark that due to Proposition \ref{In Db(X) everything is a complex of vector bundles} one can always replace bounded complexes of coherent sheaves with bounded complexes of vector bundles and compute the derived tensor product as the ordinary complex tensor product of the corresponding complexes of vector bundles. 

\subsubsection{Pull-back $f^*$}

Let $f \colon X \to Y$ be a morphism of smooth projective varieties. The \emph{pull-back} or the \emph{inverse image} functor along $f$ is defined to be 
\[
    f^* : \mod{\struct{Y}} \to \mod{\struct{X}} \qquad f^* = \struct{X} \otimes_{f\inv \struct{Y}} f\inv(-).
\]
As with the tensor product, the pull-back $f^*$ is also \emph{left exact} because it is a composition of an exact functor $f\inv \colon \mod{\struct{Y}} \to \mod{f\inv\struct{Y}}$ and a left exact functor ${\struct{X} \otimes_{f\inv\struct{Y}} (-)} \colon$ $\mod{f\inv\struct{Y}} \to \mod{\struct{X}}$. 

\begin{proposition}
    \label{pull-back of coherent sheaves}
    \emph{\cite[\S II, Proposition 5.8]{Hartshorne1977}}
    Let $f \colon X \to Y$ be a morphism of schemes. 
    \begin{enumerate}[label = (\roman*)]
        \item{If $\G$ is a quasi-coherent sheaf on $Y$, then $f^*\G$ is a quasi-coherent sheaf on $X$}
        \item{If $X$ and $Y$ are noetherian and $\G$ is a coherent sheaf on $Y$, then $f^*\G$ is a coherent sheaf on $X$.} 
    \end{enumerate}
\end{proposition}

% \begin{proof}
%     See \cite[\S II, Proposition 5.8]{Hartshorne1977}.
% \end{proof}

Clearly we may thus restrict the pull-back functor to the categories of coherent sheaves 
\[
    f^* \colon \coherent{Y} \to \coherent{X}.
\]
To derive it we will utilize the class of vector bundles on $X$.

\begin{proposition}
    \label{vector bundles f^* adapted}
    Let $f \colon X \to Y$ be a morphism of smooth projective varieties. Then the class of vector bundles on $Y$ forms an $f^*$-adapted class. 
\end{proposition}

\begin{proof}
    % Just as with The class of vector bundles is obviously closed under finite direct sums and we already know that every coherent sheaf is a quotient of some vector bundle. 
    Similarly as in the proof of Proposition \ref{vector bundles adapted to tensor product}, it remains to show that given a bounded above acyclic complex of vector bundles $\E^\bullet$ the pull-back $f^*\E^\bullet$ is still acyclic. This is verified on stalks, where one first sees that upon localizing at any $y \in Y$, the complex $\E^\bullet$ becomes an acyclic complex of free $\struct{Y,y}$-modules
    \[
        \cdots \to \E^{i-1}_y \to \E^i_y \to \E^{i+1}_y \to \cdots.
    \]
    Since localization and $f^*$ naturally commute, we see that the complex $f^*\E^\bullet$ localized at a point $x \in X$ becomes
    \[
        \cdots \to \struct{X,x} \otimes_{\struct{Y,f(x)}} \E^{i-1}_{f(x)} \to \struct{X,x} \otimes_{\struct{Y,f(x)}} \E^i_{f(x)} \to \struct{X,x} \otimes_{\struct{Y,f(x)}} \E^{i+1}_{f(x)} \to \cdots.
    \] 
    As $\E_{f(x)}^i$ are free $\struct{Y,f(x)}$-modules the sequence stays acyclic. This holds true for any $x \in X$, therefore $f^*\E^\bullet$ is acyclic.
    \qedhere
    
    % Since $f\inv$ is exact we only need to show that This follows from the fact that $f\inv\E^i$ are locally free $f\inv\struct{Y}$-modules and therefore $\struct{X} \otimes_{f\inv\struct{Y}}(-)$-acyclic and a very similar argument 

    % We show this inductively using the long exact sequence arising from the derived tensor product. Without loss of generality assume $\E^{i} \iso 0$ for $i > 0$. Let $\KK^{-1}$ denote the kernel of $d^{-1} \colon \E^{-1} \to \E^0$.
\end{proof}

\begin{corollary}
    \label{vector bundles f^* acyclic}
    Let $f \colon X \to Y$ be a morphism of smooth projective varieties. Then any vector bundle on $Y$ is $f^*$-acyclic. 
\end{corollary}

\begin{proof}
    This is a consequence of Proposition \ref{vector bundles f^* adapted} and Lemma \ref{F-adapted is F-acyclic}.
\end{proof}

Under the assumption that $f \colon X \to Y$ is a morphism of smooth projective varieties the presence of an $f^*$-adapted class ensured by Proposition \ref{vector bundles f^* adapted} allows us to derive the pull-back functor to obtain
\[
    f^* \colon \derminus{Y} \to \derminus{X}.
\]
Since any bounded complex in $\derb{Y}$ is isomorphic to a \emph{bounded} complex of vector bundles by Proposition \ref{In Db(X) everything is a complex of vector bundles} it is also clear that the functor above may be restricted to the bounded derived categories
\[
    f^* \colon \derb{Y} \to \derb{X}.
\]

\begin{remark}
    In many cases the morphism $f \colon X \to Y$ will be \emph{flat}. By definition this means that for any $x \in X$ the local ring $\struct{X, x}$ is flat as a $\struct{Y, f(x)}$-module, which in turn translates to the functor $\struct{X,x} \otimes_{\struct{Y,f(x)}} (-)$ being exact. For any such flat morphism $f$ the pull-back functor $f^* \colon \coherent{Y} \to \coherent{X}$ is exact and allows us to induce the derived functor $f^* \colon \derb{Y} \to \derb{X}$ simply by Proposition \ref{Exact functor induces a derived functor}. 
\end{remark}


\subsection{Interactions between derived functors}
\label{Subsection: Interactions between derived functors}

In this section we will present two interactions that appear between the derived functors of geometric origin. We will need them in the next chapter on Fourier--Mukai transforms, in particular when dealing with compositions of two such transforms. 

% Some of them will arise as derived incarnations of known formulas, which hold true already at the level of coherent sheaves. 

% While others are deep theorems, which are far from from being simple consequences of known facts. We will start with the former.

% \info{projection formula, base change, GV-duality}

% Define the functor $f^! \colon \derb{Y} \to \derb{X}$ to be
% \[
%     f^! = \lderived{}{f^*}(-) \otimes_{\struct{X}} \omega_f[\dim(f)],
% \]
% where $\omega_f = \omega_X \otimes f^*\omega_Y^*$ and $\dim(f) = \dim(Y) - \dim(X)$. As $\omega_f$ is just a line bundle on $X$, the tensor product need not be derived. 

% \begin{theorem}[Grothendieck-Verdier duality]
%     \label{Grothendieck-Verdier duality}
%     Let $X$ and $Y$ be smooth schemes over $k$. Let $f \colon X \to Y$ be a proper morphism. Then for every $\F^\bullet$ in $\derb{X}$ and $\E^\bullet$ of $\derb{Y}$, there is an isomorphism in $\derb{Y}$
%     \[
%         \rderived{}{f_*}\rderived{}{\localhom^\bullet_X}(\F^\bullet, f^! \E^\bullet) \iso \rderived{}{\localhom^\bullet_Y}(\rderived{}{f_*}(\F^\bullet), \E^\bullet),
%     \]
%     which is natural in $\F^\bullet$ and $\E^\bullet$.
% \end{theorem}

% \begin{proof}
%     See \cite[Chapter VII, \S 4, Corollary 4.3]{Hartshorne1966}.
% \end{proof}

% \begin{remark}
%     Serre duality in the form of Theorem \ref{Serre duality for derived cats} is seen to follow from Grothendieck-Verdier duality by the next argument.
% \end{remark}

\begin{proposition}[Flat base change formula, \text{\cite[\S 3.3]{huybrechts2006fouriermukai}}]
    \label{flat base change formula}
    Let the following be a pull-back square of smooth projective varieties
    \[\begin{tikzcd}[row sep = 2.8em]
        % https://q.uiver.app/#q=WzAsNCxbMCwwLCJYJyJdLFswLDEsIlgiXSxbMSwxLCJZIl0sWzEsMCwiWSciXSxbMSwyLCJmIl0sWzMsMiwiZyJdLFswLDEsInYiLDJdLFswLDMsInUiXSxbMCwyLCIiLDEseyJzdHlsZSI6eyJuYW1lIjoiY29ybmVyIn19XV0=
        {X'} & {Y'} \\
        X & Y
        \arrow["u", from=1-1, to=1-2]
        \arrow["v"', from=1-1, to=2-1]
        \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
        \arrow["g", from=1-2, to=2-2]
        \arrow["f", from=2-1, to=2-2]
    \end{tikzcd}\]
    Assuming $f\colon X \to Y$ is flat and $g \colon Y' \to Y$ is proper, then $u \colon X' \to Y'$ is flat and there is a natural isomorphism of functors $\derb{Y'} \to \derb{X}$
    \begin{equation}
        \label{eq: flat base change formula}
        f^*\circ \rderived{}{g_*} \natiso \rderived{}{v_*} \circ u^*.
    \end{equation}
\end{proposition}

\begin{proof}
    % See \cite[\href{https://stacks.math.columbia.edu/tag/02KH}{Tag 02KH}]{stacks-project}.
    See \cite[\S II.5, Proposition 5.12]{Hartshorne1966}.
\end{proof}

The following projection formula we will see is just a derived incarnation of the ordinary projection formula, which is known to hold for sheaves.

\begin{proposition}[Projection formula, \text{\cite[\S II.5, Proposition 5.6]{Hartshorne1966}}]
    \label{projection formula}
    Let $f \colon X \to Y$ be a proper map between projective schemes over $k$. Let $\F^\bullet$ and $\E^\bullet$ denote complexes belonging to $\derb{X}$ and $\derb{Y}$ respectively. Then there is an isomorphism of complexes in $\derb{Y}$
    \begin{equation}
        \label{eq: projection formula}
        \rderived{}{f_*}(\derivedtensor{\F^\bullet}{\lderived{}{f^*\E^\bullet}}{\struct{X}}) \iso \derivedtensor{\rderived{}{f_*}\F^\bullet}{\E^\bullet}{\struct{Y}}.
    \end{equation}
\end{proposition}

\begin{proof}
    We first recall the underived version of the projection formula, from which we will derive \eqref{eq: projection formula}. It states that for any morphism of $f \colon X \to Y$, coherent sheaf $\F$ on $Y$ and locally free sheaf $\E$ on $X$
    \begin{equation}
        \label{eq: underived projection formula}
        f_*(\F \otimes_{\struct{Y}} f^*\E) \iso f_*\F \otimes_{\struct{X}} \E.
    \end{equation}
    By Proposition \ref{In Db(X) everything is a complex of vector bundles} we may assume $\E^\bullet$ is a complex of locally free sheaves on $Y$, otherwise we just replace it by an isomorphic complex of this sort. Then $f^*\E^\bullet$ is a complex of locally free sheaves on $X$ (we can check local freeness on stalks because of the useful criterion found in \cite[\S 1, Lemma 5.1.3]{Weibel2013}). This already implies that it is enough to only show
    \[
        \rderived{}{f_*}({\F^\bullet}\otimes_{\struct{X}}{{f^*\E^\bullet}}) \iso {\rderived{}{f_*}\F^\bullet}\otimes_{\struct{Y}}{\E^\bullet},
    \]
    where the pull-back and the tensor product are underived. Let $\I^\bullet \to \F^\bullet$ be an injective resolution of $\F^\bullet$, momentarily accessing the category of quasi-coherent sheaves on $X$. Since $f^*\E^\bullet$ is locally free, we see that 
    \[
        \I^\bullet \otimes_{\struct{X}} f^*\E^\bullet \to \F^\bullet \otimes_{\struct{X}} f^*\E^\bullet
    \] 
    is an injective resolution of $\F^\bullet \otimes_{\struct{X}} f^*\E^\bullet$, because $(-) \otimes_\struct{X} f^*\E^\bullet$ is exact and tensoring injectives with locally free sheaves again results in an injective sheaf \cite[\href{https://stacks.math.columbia.edu/tag/01E7}{Tag 01E7}]{stacks-project}. This means that we can compute $\rderived{}{f_*}$ using this resolution. Utilizing \eqref{eq: underived projection formula} on each term of the complex now lets us see that 
    \[
        \rderived{}{f_*}({\F^\bullet}\otimes_{\struct{X}}{{f^*\E^\bullet}}) \iso
        f_*(\I^\bullet \otimes_{\struct{X}} f^*\E^\bullet) \iso f_*\I^\bullet \otimes_{\struct{Y}} \E^\bullet \iso
        {\rderived{}{f_*}\F^\bullet}\otimes_{\struct{Y}}{\E^\bullet}. \qedhere
    \]
\end{proof}